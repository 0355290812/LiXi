<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>L√¨ X√¨ T·∫øt</title>
    <link rel="stylesheet" href="https://lixi-xajh.onrender.com/style.css">
    <style>
        @keyframes bounce {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateY(0);
            }

            40% {
                transform: translateY(-20px);
            }

            60% {
                transform: translateY(-10px);
            }
        }

        .envelope.animate {
            animation: bounce 0.5s;
        }

        /* Animation cho k·∫øt qu·∫£ hi·ªÉn th·ªã: fadeIn */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s;
        }

        /* CSS cho n√∫t "B·ªëc l·∫°i" */
        .button {
            padding: 10px 20px;
            font-size: 1rem;
            background-color: #d12e2e;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            margin: 20px auto;
            display: block;
        }

        .button:hover {
            background-color: #ff6f61;
            transform: scale(1.1);
        }

        /* CSS cho hi·ªáu ·ª©ng hoa ƒë√†o r∆°i */
        .flower-container {
            position: fixed;
            top: -50px;
            pointer-events: none;
            z-index: 1000;
            animation: fall linear infinite;
        }

        .flower {
            font-size: 24px;
            animation: spin 5s linear infinite;
        }

        @keyframes fall {
            0% {
                transform: translateY(0);
                opacity: 1;
            }

            100% {
                transform: translateY(110vh);
                opacity: 0;
            }
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üå∏ Ch√∫c M·ª´ng NƒÉm M·ªõi üå∏</h1>
        <h3>B·ªëc l√¨ x√¨ ƒë·∫ßu nƒÉm may m·∫Øn n√†o!</h3>

        <div class="envelopes">
            <div class="envelope" onclick="openEnvelope(1)">üßß</div>
            <div class="envelope" onclick="openEnvelope(2)">üßß</div>
            <div class="envelope" onclick="openEnvelope(3)">üßß</div>
        </div>

        <!-- K·∫øt qu·∫£ hi·ªÉn th·ªã -->
        <div id="result"></div>

        <!-- N√∫t "B·ªëc l·∫°i", ·∫©n ban ƒë·∫ßu -->
        <button id="retryButton" onclick="resetGame()" style="display: none;" class="button">B·ªëc l·∫°i</button>
    </div>

    <script>
        async function openEnvelope(index) {
            // L·∫•y ph·∫ßn t·ª≠ phong bao ƒë∆∞·ª£c click v√† th√™m l·ªõp animation
            const envelopeElement = event.target;
            envelopeElement.classList.add('animate');
            // Lo·∫°i b·ªè l·ªõp animation sau th·ªùi gian animation (0.5s)
            setTimeout(() => {
                envelopeElement.classList.remove('animate');
            }, 500);
            // G·ªçi API ƒë·ªÉ nh·∫≠n l√¨ x√¨
            const response = await fetch("/api/liexi", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
            });

            const data = await response.json();
            const resultDiv = document.getElementById("result");

            if (response.status === 400) {
                resultDiv.innerHTML = `<p style='color: red;'>${data.message}</p>`;
            } else {
                resultDiv.innerHTML = `
          <h2>${data.message}</h2>
          <h3>${data.value.toLocaleString()} VND üéâ</h3>
        `;
                resultDiv.classList.add('fade-in');
                setTimeout(() => {
                    resultDiv.classList.remove('fade-in');
                }, 500);
            }

            // Hi·ªán n√∫t "B·ªëc l·∫°i"
            document.getElementById("retryButton").style.display = "block";
            // T·∫°o hi·ªáu ·ª©ng hoa ƒë√†o r∆°i khi b·∫•m b·ªëc l√¨ x√¨
            createFallingFlowers();
        }

        function resetGame() {
            // X√≥a k·∫øt qu·∫£ hi·ªÉn th·ªã
            document.getElementById("result").innerHTML = "";
            // ·∫®n n√∫t "B·ªëc l·∫°i"
            document.getElementById("retryButton").style.display = "none";
            // X√≥a c√°c ph·∫ßn t·ª≠ hoa ƒë√†o hi·ªán c√≥ (n·∫øu c√≤n)
            document.querySelectorAll('.flower-container').forEach(flower => flower.remove());
        }

        function createFallingFlowers() {
            const numFlowers = 50; // S·ªë l∆∞·ª£ng hoa ƒë√†o r∆°i
            for (let i = 0; i < numFlowers; i++) {
                const flowerContainer = document.createElement('div');
                flowerContainer.className = 'flower-container';
                // ƒê·∫∑t v·ªã tr√≠ ngang ng·∫´u nhi√™n
                flowerContainer.style.left = Math.random() * window.innerWidth + 'px';
                // Th·ªùi gian animation ng·∫´u nhi√™n t·ª´ 5s ƒë·∫øn 10s
                const duration = Math.random() * 5 + 5;
                flowerContainer.style.animationDuration = duration + 's';
                // ƒê·ªô tr·ªÖ animation ng·∫´u nhi√™n t·ª´ 0s ƒë·∫øn 5s
                const delay = Math.random() * 5;
                flowerContainer.style.animationDelay = delay + 's';

                const flower = document.createElement('div');
                flower.className = 'flower';
                // S·ª≠ d·ª•ng emoji hoa ƒë√†o (üå∏)
                flower.innerText = 'üå∏';
                flowerContainer.appendChild(flower);
                document.body.appendChild(flowerContainer);

                // X√≥a hoa sau khi animation ho√†n th√†nh (duration + delay)
                setTimeout(() => {
                    flowerContainer.remove();
                }, (duration + delay) * 1000);
            }
        }
    </script>
</body>

</html>